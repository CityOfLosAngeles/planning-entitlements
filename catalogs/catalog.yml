metadata:
  version: 1
sources:
  # Open Data Portals
  la_open_data:
    driver: dcat
    args:
      url: https://data.lacity.org/data.json
  la_geohub:
    driver: dcat
    args:
      url: http://geohub.lacity.org/data.json
      items:
        city_boundary: http://geohub.lacity.org/datasets/09f503229d37414a8e67a7b6ceb9ec43_7
  la_county_open_data:
    driver: dcat
    args:
      url: https://data.lacounty.gov/data.json
  scag_gis_portal:
    driver: dcat
    args:
      url: http://gisdata-scag.opendata.arcgis.com/data.json
  # General
  parcels2014:
    driver: shapefile
    description: LA County Tax Assessor 2014 Parcels shapefile
    args:
      urlpath: zip+s3://city-planning-entitlements/gis/raw/la_parcels.zip
  pcts:
    driver: sql_cat
    description: Los Angeles Planning Case Tracking System (PCTS) snapshot
    args:
      uri: "{{env(POSTGRES_URI)}}"
      sql_kwargs:
        schema: pcts
  pcts2:
    driver: parquet
    description: Master PCTS data.
    args:
      urlpath: "s3://city-planning-entitlements/data/final/master_pcts.parquet"
      engine: "pyarrow"
  pcts_parents:
    driver: parquet
    description: Parent cases for PCTS data.
    args:
      urlpath: s3://city-planning-entitlements/data/final/parents_with_prefix_suffix.parquet
      engine: pyarrow
  # Transit
  metro_bus_stops:
    driver: shapefile
    description: Metro bus stops downloaded from Metro Developer
    args:
      urlpath: zip+s3://city-planning-entitlements/gis/source/BusStopServingLines1219.zip
  metro_bus_lines:
    driver: shapefile
    description: Metro bus lines downloaded from Metro Developer
    args:
      urlpath: zip+s3://city-planning-entitlements/gis/source/BusLineServingStops1219.zip
  metro_rail_lines:
    driver: geojson
    description: Metro rail lines downloaded from Metro Developer
    args:
      urlpath: s3://city-planning-entitlements/gis/source/Metro_Rail_Lines.geojson
  metro_rail_stations:
    driver: geojson
    description: Metro rail stations downloaded from Metro Developer
    args:
      urlpath: s3://city-planning-entitlements/gis/source/Metro_Rail_Stations.geojson
  metro_rapid_bus_lines:
    driver: shapefile
    description: Metro rapid bus lines downloaded from Metro Developer
    args:
      urlpath: zip+s3://city-planning-entitlements/gis/source/RapidBRT1219.zip
  metrolink_routes:
    driver: geojson
    description: Metrolink routes from SCAG Open Data (which had CRS error)
    args:
      urlpath: s3://city-planning-entitlements/gis/source/metrolink_routes.geojson
  street_intersections:
    driver: geojson
    description: LADOT street intersections (points), used for Vision Zero analysis
    args:
      urlpath: s3://city-planning-entitlements/gis/source/la_intersections.geojson
  toc_tiers:
    driver: shapefile
    description: TOC Tiers from October 2017. Refer to data-workflow-notes for creating TOC tiers file.
    args:
      urlpath: zip+s3://city-planning-entitlements/gis/source/TOC_Tiers_Oct2017.zip
  # TOC Analysis
  toc_parcels_with_entitlements:
    driver: geojson
    description: TOC-eligible parcels with entitlement data attached.
    args:
      urlpath: s3://city-planning-entitlements/gis/intermediate/toc_eligible_parcels_with_entitlements.geojson
  # Census
  # NEED TO FIX THIS BECAUSE IT'S GEOPARQUET, needs to be downloaded first
  census_analysis_table:
    driver: parquet
    description: Census data reshaped to tract-level using 2018 ACS data, in notebooks/B1-census-tract-stats.ipynb.
    args:
      urlpath: s3://city-planning-entitlements/data/final/census_analysis_table.parquet
      engine: pyarrow
  census_cleaned:
    driver: parquet
    description: Census data pared down for outcomes of interest, in src/C4_subset_census.py. Instead, use census_analysis_table for analysis.
    args:
      urlpath: s3://city-planning-entitlements/data/final/census_cleaned.parquet
      engine: pyarrow
  census_cleaned_full:
    driver: parquet
    description: Census data fully cleaned in src/C3_clean_census.py. Instead, use census_analysis_table for analysis.
    args:
      urlpath: s3://city-planning-entitlements/data/final/census_cleaned_full.parquet
      engine: pyarrow 
  census_tracts:
    driver: geojson
    description: Census tracts within City of LA with 2017 ACS 5-year population. Use primarily for the geometry.
    args:
      urlpath: s3://city-planning-entitlements/gis/raw/census_tracts_withpop.geojson
  crosswalk_parcels_tracts:
    driver: parquet
    description: Crosswalk linking parcels to tracts. Store number of duplicate parcels in column num_AIN.
    args:
      urlpath: s3://city-planning-entitlements/data/crosswalk_parcels_tracts.parquet
      engine: pyarrow